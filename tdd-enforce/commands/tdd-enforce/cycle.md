---
description: TDD の Red-Green-Refactor サイクルをフルガイドモードで実行する。各ステップでユーザー確認を取りながら進める。
---

# tdd-enforce: cycle

TDD の Red → Green → Refactor サイクルをガイドします。ユーザーから実装したい機能の説明を受け取り、ステップバイステップで進めます。

## 手順

### 0. 機能の確認

ユーザーに実装したい機能を確認する:

```
TDD サイクルを開始します。
何を実装しますか？（機能や振る舞いを説明してください）
```

### 1. Red フェーズ（失敗するテストを書く）

1. ユーザーの説明から、テストすべき振る舞いを特定する
2. テストコードを作成する（言語・フレームワークに合わせる）
3. テストファイルを書き出す前に、テストの内容をユーザーに見せる

```
## 🔴 Red フェーズ

以下のテストを作成します:

[テストコードを表示]

このテストでよろしいですか？
```

4. ユーザーの了承を得てからテストファイルを作成する
5. テストを実行して失敗することを確認する

```bash
# テスト実行（言語に応じたコマンド）
cargo test / npx vitest run / pytest / go test ./...
```

6. テストが失敗したことをユーザーに報告:

```
✓ テストが失敗しました（Red 達成）

失敗内容: [エラーメッセージ]

次のステップ: Green フェーズに進みますか？
```

### 2. Green フェーズ（最小限の実装）

1. テストをパスするための最小限の実装を提案する
2. 実装コードをユーザーに見せる

```
## 🟢 Green フェーズ

テストをパスする最小限の実装:

[実装コードを表示]

この実装でよろしいですか？
```

3. ユーザーの了承を得てからコードを書き出す
4. テストを実行してパスすることを確認する

```
✓ テストがパスしました（Green 達成）

次のステップ: Refactor フェーズに進みますか？（スキップも可）
```

### 3. Refactor フェーズ（コード改善）

1. 現在のコードを分析し、改善点を提案する:
   - 重複の排除
   - 命名の改善
   - 構造の整理
   - パフォーマンス改善

```
## 🔧 Refactor フェーズ

以下の改善を提案します:

1. [改善提案1]
2. [改善提案2]

リファクタリングを実行しますか？
```

2. 改善がない場合はスキップ:

```
現在のコードに大きな改善点はありません。Refactor をスキップします。
```

3. リファクタリング実行後、テストを再実行して依然パスすることを確認:

```
✓ リファクタリング完了。全テストパス。
```

### 4. サイクル完了

```
## ✓ TDD サイクル完了

実装した機能: [機能名]
作成/変更したファイル:
  - [テストファイル]
  - [実装ファイル]

続けて次の機能を TDD で実装しますか？
  1. 次の TDD サイクルを開始
  2. 終了
```

## 重要な原則

- **テストは必ず先に書く**。実装を先に書いてはいけない。
- **Green では最小限の実装のみ**。完璧を目指さない。
- **各ステップでユーザー確認**。勝手に進めない。
- **テスト実行は各フェーズで必ず行う**。Red で失敗確認、Green でパス確認、Refactor で回帰確認。
